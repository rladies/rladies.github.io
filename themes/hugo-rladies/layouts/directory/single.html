
{{ define "main" }}
  <div class="entry-content">
		{{ .Content }}
	</div>

  <div class="flex-container full-width" id="directory-content">
    
    <center class="m-2">
      <input type="text" id="dir-search" class="fuzzy-search rounded" placeholder="Search directory..."/>
      <button class="btn btn-primary rounded sort" data-sort="name">Sort by name</button>
      <!-- <buttonr id="shuffle" type="button" class="btn btn-primary rounded">Randomly shuffle</buttonr> -->

    <div class="container" id="directory-cards">
        <ul class="list row row-cols-sm-1 row-cols-md-2 row-cols-lg-3" id="directory-grid">
            {{ $directory := ( .Scratch.Get "directory" ) }}
            {{ range $name := $.Scratch.Get "dic" | shuffle }}
              {{ $d := index $directory $name }}
              {{ partial "directory/li.html" $d }}
            {{ end }}
        </ul>
      </div>
      
      <!-- pagination nav -->
      <div class="nav pagination justify-content-center align-content-center" aria-label="Directory pagination">
        <a class="pagination-prev" href="#directory-content" onclick=".prev()"><</a>
        <ul class="pagination-layout"></ul>
        <a class="pagination-next" href="#directory-content" onclick=".next()">></a>
      </div>
      
    </div>
  </div> 
{{ end }}

{{ define  "footer" }}
{{ if eq hugo.Environment "production" }}
  {{ .Scratch.Set "n_page_directory" 25}}
{{ else }}
  {{ .Scratch.Set "n_page_directory" 5}}
{{ end }} 

	<script>
    var perPage = {{  ( .Scratch.Get "n_page_directory" ) }};
  	(async function(){
      var directoryList = new List('directory-content', {
        valueNames: ['name', 'interests', 'shiny_apps', 'r_groups', 'r_packages', 'location'],
        searchColumns: ['name', 'interests', 'shiny_apps', 'r_groups', 'r_packages', 'location'],
        page: perPage,
        pagination: {
          innerWindow: 1,
          left: 0,
          right: 0,
          paginationClass: "pagination-layout",
          item: "<li><a class='page' href='#directory-content'></a></li>"
        },
        fuzzySearch: {
          searchClass: "fuzzy-search",
          distance: 150,
          multiSearch: true
        }
      }).on("updated", function(list) {
        // make the Prev and Nex buttons disabled on first and last pages accordingly
        $(".pagination-prev.disabled, .pagination-next.disabled").removeClass(
          "disabled"
        );
        $(".pagination-wrap").show();

        if (list.i == 1) {
          $(".pagination-prev").addClass("disabled");
        }
        if (list.i > list.matchingItems.length - list.page) {
          $(".pagination-next").addClass("disabled");
        }
      
        // hide pagination if there one or less pages to show
        if (list.matchingItems.length <= perPage) {
          $(".pagination-wrap").hide();
        }
      });
      


      // find url anchor and populate search field.
      var entry = decodeURIComponent(window.location.hash.substr(1));
      if(entry !== "directory-content"){
        document.getElementById("dir-search").value = entry;
        // Search manually
        directoryList.fuzzySearch(entry);
      }
  	})();
        

	</script>
{{ end }}