
{{ define "main" }}

  <div class="card shadow-sm mb-4">
      <div class="card-body">
          <dl class="row mb-0">
              {{ with .Params.status }}
                  <dt class="col-sm-4">Status</dt>
                  <dd class="col-sm-8">
                  <span class="badge {{ if eq . "active" }}bg-rladies {{ else }} bg-warning {{ end }}">{{ . | humanize }}</span>
                  </dd>
              {{ end }}

              <dt class="col-sm-4">Location</dt>
              <dd class="col-sm-8">
              {{ with .Params.city }}{{ . }}, {{ end }}
              {{ with .Params.state_region }}
                  {{ . }}, 
              {{ end }}
              {{ with .Params.country }}
                  {{ . }}
              {{ end }}
              </dd>

              {{ with .Params.social_media }}
                  <dt class="col-sm-4">Connect with this chapter</dt>
                  <dd class="col-sm-8">
                      {{ partial "social_media.html" (dict "data" . "relme" true) }}
                  </dd>
              {{ end }}

          </dl>
      </div>
  </div>

  {{ with .Params.organizers }}
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h2 class="card-title h4 mb-3">Organizers</h2>

        <ul class="nav nav-tabs" id="organizerTabs" role="tablist">
          <li class="nav-item">
            <button class="nav-link active" id="current-tab" data-toggle="tab" data-target="#current-organizers" role="tab">Current</button>
          </li>
          <li class="nav-item">
            <button class="nav-link" id="former-tab" data-toggle="tab" data-target="#former-organizers" role="tab">Former</button>
          </li>
        </ul>

        <div class="tab-content" id="organizerTabsContent">
          <div class="tab-pane fade show active" id="current-organizers" role="tabpanel" aria-labelledby="current-tab">
            {{ with .current }}
              <ul class="list-group list-group-flush mb-3">
                {{ range . }}
                  <li class="list-group-item">{{ . }}</li>
                {{ end }}
              </ul>
            {{ end }}
          </div>

          {{ with .former }}
            <div class="tab-pane fade" id="former-organizers" role="tabpanel" aria-labelledby="former-tab">
              <ul class="list-group list-group-flush mb-3">
                {{ range . }}
                  <li class="list-group-item">{{ . }}</li>
                {{ end }}
              </ul>
            </div>
          {{ end }}
        </div>
      </div>
    </div>
  {{ end }}

{{ $chapterGroupUrlname := .Params.urlname }}
{{ $allEvents := site.Data.meetup.events }}
{{ $currentDate := now }}

{{ $upcomingEvents := slice }}
{{ $formerEvents := slice }}

{{ range $event := $allEvents }}
  {{ if eq $event.group_urlname $chapterGroupUrlname }}
    {{ $eventStart := time.AsTime $event.start }}
    {{ if $eventStart.After $currentDate }}
      {{ $upcomingEvents = $upcomingEvents | append $event }}
    {{ else }}
      {{ $formerEvents = $formerEvents | append $event }}
    {{ end }}
  {{ end }}
{{ end }}

{{ $upcomingEvents = sort $upcomingEvents "start" }}
{{ $formerEvents = sort $formerEvents "start" "desc" }}

{{ if or $upcomingEvents $formerEvents }}
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h2 class="card-title h4 mb-3">Chapter Events</h2>

      <!-- Nav tabs -->
      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item" role="presentation">
          <a class="nav-link active" id="upcoming-tab" data-toggle="tab" href="#upcoming" role="tab" aria-controls="upcoming" aria-selected="true">
            Upcoming ({{ len $upcomingEvents }})
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link" id="former-tab" data-toggle="tab" href="#former" role="tab" aria-controls="former" aria-selected="false">
            Former ({{ len $formerEvents }})
          </a>
        </li>
      </ul>

      <!-- Tab panes -->
      <div class="tab-content pt-3">
        <!-- Upcoming Events Tab -->
        <div class="tab-pane fade show active" id="upcoming" role="tabpanel" aria-labelledby="upcoming-tab">

          {{ if gt (len $upcomingEvents) 0 }}
            {{ $nextEvent := index $upcomingEvents 0 }}
            <h3 class="h5 text-primary mb-3">Next Upcoming Event:</h3>
            <div class="card text-center mb-4 border-primary shadow">
              <div class="card-header bg-primary text-white h4">{{ $nextEvent.title }}</div>
              <div class="card-body">
                <p class="card-text lead">
                  <i class="bi bi-calendar-event me-2"></i>{{ dateFormat "Monday, January 2, 2006 at 3:04 PM" (time.AsTime $nextEvent.start) }}
                </p>
                {{ if $nextEvent.location }}
                  <p class="card-text text-muted">
                    <i class="bi bi-geo-alt-fill me-2"></i>{{ $nextEvent.location }}
                  </p>
                {{ end }}
              </div>
            </div>

            {{ $upcomingEvents = after 1 $upcomingEvents }}
          {{ end }}

          {{ if gt (len $upcomingEvents) 0 }}
            <h3 class="h5 mt-4 mb-3">Other Upcoming Events:</h3>
            <ul class="list-group list-group-flush mb-4">
              {{ range $event := $upcomingEvents }}
                <li class="list-group-item d-flex justify-content-between align-items-start">
                  <div>
                    <h4 class="h6 mb-1">{{ $event.title }}</h4>
                    <small class="text-muted">
                      <i class="bi bi-calendar me-1"></i>{{ dateFormat "Jan 2, 2006" (time.AsTime $event.start) }}
                      {{ if $event.location }}<br><i class="bi bi-geo-alt me-1"></i>{{ $event.location }}{{ end }}
                    </small>
                  </div>
                  {{ with $event.id }}
                    <a href="https://www.meetup.com/{{ $chapterGroupUrlname }}/events/{{ . }}" target="_blank" rel="noopener" class="btn btn-sm btn-outline-primary ms-3">Details <i class="bi bi-box-arrow-up-right"></i></a>
                  {{ end }}
                </li>
              {{ end }}
            </ul>
          {{ else if eq (len $upcomingEvents) 0 }}
            <p class="text-muted">No upcoming events.</p>
          {{ end }}

        </div>

        <!-- Former Events Tab -->
        <div class="tab-pane fade" id="former" role="tabpanel" aria-labelledby="former-tab">
          {{ if gt (len $formerEvents) 0 }}
            <ul class="list-group list-group-flush">
              {{ range $event := $formerEvents }}
                <li class="list-group-item d-flex justify-content-between align-items-start text-muted">
                  <div>
                    <h4 class="h6 mb-1">{{ $event.title }}</h4>
                    <small>
                      <i class="bi bi-calendar-x me-1"></i>{{ dateFormat "Jan 2, 2006" (time.AsTime $event.start) }}
                      {{ if $event.location }}<br><i class="bi bi-geo-alt me-1"></i>{{ $event.location }}{{ end }}
                    </small>
                  </div>
                  {{ with $event.id }}
                    <a href="https://www.meetup.com/{{ $chapterGroupUrlname }}/events/{{ . }}" target="_blank" rel="noopener" class="btn btn-sm btn-outline-secondary ms-3">Details <i class="bi bi-box-arrow-up-right"></i></a>
                  {{ end }}
                </li>
              {{ end }}
            </ul>
          {{ else }}
            <p class="text-muted">No events, yet.</p>
          {{ end }}
        </div>
      </div>
    </div>
  </div>
{{ end }}

{{ end }}
