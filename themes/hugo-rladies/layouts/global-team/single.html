{{ define "main" }}
{{ $global_team := $.Site.Data.global_team }}
{{ $gt_current := $global_team.current }}
{{ $gt_alumni := $global_team.alumni }}

<div class="entry-content">
  {{ .Content }}
</div>

{{ $path := $.Site.GetPage "section" "global-team" }}

<!-- Build shuffleable slices -->
{{ $current_keys := slice }}
{{ range $key, $_ := $gt_current }}
  {{ $current_keys = $current_keys | append $key }}
{{ end }}

{{ $alumni_keys := slice }}
{{ range $key, $_ := $gt_alumni }}
  {{ $alumni_keys = $alumni_keys | append $key }}
{{ end }}

<!-- Leadership Team -->
<div class="container expand-grid" id="leadership-team">
  <h1 class="section-title">{{ i18n "leadership" }}</h1>
  <ul class="justify-content-center row row-xl-2 row-lg-3 row-md-4 row-sm-6 row-9 w-100 list-unstyled">
    {{ range $current_keys | shuffle }}
      {{ $d := index $gt_current . }}
      {{ if in $d.role "Leadership" }}
        {{ $image := "" }}
        {{ with $path.Resources.GetMatch (printf "img/%s*" .) }}
          {{ $image = (.Fill "200x200").RelPermalink }}
        {{ end }}
        
        {{ $foot := "" }}
        {{ with $d.img.credit }}
          {{ $foot = printf "<p class=\"card-text text-muted\"><small>Photo credit: %s</small></p>" . }}
        {{ end }}

        {{ partial "funcs/card-expand.html" (dict "title" $d.name "img" $image "size" "small" "descr" $foot) }}
      {{ end }}
    {{ end }}
  </ul>
</div>

<!-- Roles Table -->
<h1 class="section-title">{{ i18n "global-team" }}</h1>
<div class="my-5">
  <table class="table table-sm w-auto mx-auto">
    <thead>
      <tr>
        <th class="text-end border-primary border-end">role</th>
        <th class="text-start">name</th>
      </tr>
    </thead>
    <tbody>
      {{ $roles := slice }}
      {{ range $gt_current }}
        {{ range .role }}
          {{ $roles = $roles | append . }}
        {{ end }}
      {{ end }}
      {{ $roles = $roles | uniq | sort }}
      
      {{ range $roles | shuffle }}
        {{ $role := . }}
        {{ $members := slice }}
        {{ range $gt_current }}
          {{ if in .role $role }}
            {{ $members = $members | append .name }}
          {{ end }}
        {{ end }}
        
        <tr>
          <td class="text-end border-primary border-end align-top" rowspan="{{ len $members }}">{{ $role }}</td>
          {{ range $idx, $name := $members | shuffle }}
            {{ if gt $idx 0 }}<tr>{{ end }}
            <td class="text-start align-top">{{ $name }}</td>
          </tr>
          {{ end }}
      {{ end }}
    </tbody>
  </table>

  <!-- Current Team Cards -->
  <div class="container expand-grid">
    <ul class="justify-content-center row row-xl-2 row-lg-3 row-md-4 row-sm-6 row-9 w-100 list-unstyled">
      {{ range $current_keys | shuffle }}
        {{ $d := index $gt_current . }}
        {{ $image := "" }}
        {{ with $path.Resources.GetMatch (printf "img/%s*" .) }}
          {{ $image = (.Fill "200x200").RelPermalink }}
        {{ end }}
        
        {{ $credit := "" }}
        {{ with $d.img.credit }}
          {{ $credit = printf "<p class=\"card-text text-muted\"><small>Photo credit: %s</small></p>" . }}
        {{ end }}

        {{ partial "funcs/card-expand.html" (dict "title" $d.name "img" $image "foot" (delimit $d.role ", ") "size" "small" "descr" $credit) }}
      {{ end }}
    </ul>
  </div>
</div>

<hr>

<!-- Alumni -->
<div class="my-5">
  <h1 class="section-title">{{ i18n "alumni" }}</h1>
  <p>{{ i18n "alumni-text" }}</p>
  <div class="container expand-grid">
    <ul class="justify-content-center row row-xl-2 row-lg-3 row-md-4 row-sm-6 row-9 w-100 list-unstyled">
      {{ range $alumni_keys | shuffle }}
        {{ $d := index $gt_alumni . }}
        {{ $image := "" }}
        {{ with $path.Resources.GetMatch (printf "img/%s*" .) }}
          {{ $image = (.Fill "200x200").RelPermalink }}
        {{ end }}
        
        {{ $dates := printf "%s &#8212 %s" $d.start $d.end }}
        {{ partial "funcs/card-expand.html" (dict "title" $d.name "img" $image "descr" $dates "size" "small" "foot" (delimit $d.role ", ")) }}
      {{ end }}
    </ul>
  </div>
</div>
{{ end }}