{{ define "main" }}


{{ $rb := slice }}
{{ $rblogs := $.Site.Data.rblogs }}
{{ range $name, $_ := $.Site.Data.rblogs }}
  {{ $rb = $rb | append $name }}
{{ end }}

<div class="entry-content">
	{{ .Content }}
</div>

  <div class="container-fluid p-0 px-3">
    <ul class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4 shuffle-wrapper w-100 list-unstyled" id="rladies-blogs-grid">
      {{ range $name := $rb | shuffle }}
        {{ $rb := index $rblogs $name }}
        {{ $data := newScratch }}
        {{ $data.Set "descr" "" }}

        {{ range $rb.authors }}
          {{ $data.Add "descr" "<p>" }}
          {{ $data.Add "descr" .name }}
            {{ with .social_media }}
              {{ range . }}
                {{ $data.Add "descr" (partial "social_media.html" (dict "data" . "range" 3)) }}
              {{ end }}
            {{ end }}
          {{ $data.Add "descr" "</p>" }}
        {{ end }}
        {{ $descr :=  $data.Get "descr" }}
        
        {{ $data.Set "photo" (printf "https://www.gravatar.com/avatar/%s?s=100&d=identicon" ( md5 $rb.url ) ) }}
        {{ with $rb.photo_url }}
          {{ with try (resources.GetRemote .) }}
            {{ with .Err }}
              {{ warnf "%s" . }}
            {{ else with .Value }}
              {{ if in (slice "image/jpeg" "image/png" "image/gif" "image/webp" "image/svg+xml") .Data.ContentType }}
                {{ $img := . }}
                {{ $img := $img.Fill "300x300" }} 
                {{ $data.Set "photo" $img.RelPermalink }}
              {{ else }}
                {{ warnf "Entry %s has a photo url without a supported image type" $name }}
              {{ end }}
            {{ end }}
          {{ else }}
            {{ warnf "Unable to get remote resource %q" . }}
          {{ end }}
        {{ end }}
        
        {{ $subtitle := $rb.subtitle | default "" }}
        {{ partial "funcs/card-expand.html" (dict "title" $rb.title "img" ($data.Get "photo") "subtitle" $subtitle "descr" $descr "category" $rb.type "url" $rb.url) }}
      {{ end }}
    </ul>
  </div>
{{ end }}